<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
	layout:decorator="layout/default" lang="ko">
<div  layout:fragment="content" style="background-color: #f2fbff; height: -webkit-fill-available;">
	<div class="container-fluid">
		<div class="row text-center"  style="padding-top: 50%">
			<i class="fa fa-spinner fa-spin fa-3x"></i>
			<p>로딩 중입니다.<br/> 잠시만 기다려 주세요.</p>
			<p class="p2"></p>
		</div>
	</div>
<style>
	p {
		display: none;
		font-size: 25px;
		font-family:dotum
	}
	.p2 {
		display: block;
		width: 100%;
		margin: 0 auto;
		word-break: break-all;
		margin-top:50px;
	}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var loading = {
		isApp: null,
		hostUrl: null,
		headerObj: null,
		apiTable: null,
}
$(document).ready(function() {
	changeText($("p"), $(".p2"), 100);
	loading.isApp = document.URL.indexOf("web");
	$("#head_title").hide();
	setTimeout(function(){ 
	if(loading.isApp < 0) {
		location.href="app://callback;headerinfo;homeInitialise;";
		sessionStorage.setItem("isApp", "mobile");
	} else {
		homeInitialise();
		sessionStorage.setItem("isApp", "web");
	}
	}, 500);
});

function changeText(cont1,cont2,speed){
	var Otext=cont1.text();
	var Ocontent=Otext.split("");
	var i=0;
	function show(){
		if(i<Ocontent.length) {		
			cont2.append(Ocontent[i]);
			i=i+1;
		};
	};
	var Otimer = setInterval(show,speed);	
// 	clearInterval(Otimer);
};

function homeInitialise(data) {
	getInfo(data);
	$("#head_title").hide();
}

function getInfo(data) {
	var info = null;
	if(loading.isApp < 0) {
		info = JSON.parse(data);
	}
	$.get( "/api/getInfo", function( data ) {
		loading.headerObj = new Object();
		loading.headerObj.custom = "DARBY";
		loading.headerObj.product = "DARBY";
		loading.headerObj.language = "KR";
		loading.headerObj.session = "";
		loading.headerObj.push = "";
		loading.headerObj.certkey = "DARBY";
		
		if(loading.isApp < 0) {
			loading.headerObj.os_type = info.os_type; //*
			loading.headerObj.os_ver = info.os_ver; //*
			loading.headerObj.product_ver = info.product_ver; //*
			loading.headerObj.device = info.device; //*
			loading.headerObj.device_model = info.device_model; //*
		} else {
			loading.headerObj.os_type = "01"; //*
			loading.headerObj.os_ver = "3.5.6"; //*
			loading.headerObj.product_ver = "1.5.6"; //*
			loading.headerObj.device = "FDSFSFSDAFASF"; //*
			loading.headerObj.device_model = "G6"; //*
		}
		sessionStorage.setItem("headerObj", JSON.stringify(loading.headerObj));
		getUrl(loading.headerObj);
	});
}

function getUrl(header) {
	$.get( "/api/getUrl?header=" + encodedJSON(header), function( data ) {
		console.log(JSON.parse(data))
		var response = JSON.parse(data);
		if(response.resultCode == 1000) {
			loading.hostUrl = JSON.parse(data).result.List.CustomInfo[0].HostUrl.toString();
			sessionStorage.setItem("hostUrl", loading.hostUrl);
			getApi(loading.hostUrl);
		} 
	});
}

function getApi(hostUrl) {
	$.get( "/api/getApi?hostUrl=" + hostUrl, function( data ) {
		console.log(JSON.parse(data).result.List.Table)
		loading.apiTable = JSON.parse(data).result.List.Table;
		sessionStorage.setItem("api", JSON.stringify(loading.apiTable));
	}).done(function(data) {
		location.href = "/homeEx"
	});
}

/*]]>*/
</script>
</div>
</html>