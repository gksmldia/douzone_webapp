<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
	layout:decorator="layout/default" lang="ko">
<div  layout:fragment="content">
	<div class="container-fluid" style="padding-top: 25%;">
		<div class="row">
			<div class="col-xs-12 col-sm-12">
				<form class="form-horizontal" style="font-size: 11pt;">
					<div class="form-group">
						<label for="thisWeek " class="col-xs-4 col-sm-3 control-label padTop4 text-muted"  style="padding-right: 0px;">이번주적용돈가</label>
						<div class="col-xs-7 col-sm-8">
							<input type="text"  class="form-control" id="businessField" />
						</div>
						<label class="padTop4 text-muted">원</label>
					</div>
					<div class="form-group" style="margin-bottom: 50px;">
						<label for="beforeDay" class="col-xs-4 col-sm-3 control-label padTop4 text-muted"  style="padding-right: 0px;">
							전일돈가
							<small id="yesterDay"></small> 
						</label>
						<div class="col-xs-7 col-sm-8">
							<input type="text"  class="form-control" id="beforeDay"  />
						</div>
						<label class="padTop4 text-muted">원</label>
					</div>
					<div class="form-group">
						<label for="infoDays" class="col-xs-2 col-sm-4 control-label padTop4 text-muted" style="padding-right: 0px">기간</label>
						<div class="col-xs-10 col-sm-8">
							 <div class='input-group date  input-daterange' >
					            <div class='input-group date' >
					                <input type='text' class="form-control"   id="start_day"/>
					            </div>
						            <span class="input-group-addon">-</span>
					             <div class='input-group date' >
					                <input type='text' class="form-control"  id="end_day" />
					            </div>
				            </div>
			            </div>
					</div>
					<div class="form-group" style="padding-right: 20px;">
						<button type="button" class="btn btn-info col-xs-offset-6 col-xs-6 col-sm-offset-4 col-sm-4" id="price_information_search">
							<i class="fa fa-binoculars" aria-hidden="true"></i>&nbsp;조회
						</button>
					</div>
				</form>
				<div class="row">
					<div id="price_information_grid"></div>
				</div>
				<div class="row">
					<div class="btn-group text-center"  role="group"  style="padding: 16px 20% 16px;">
						<button type="button"  class="btn btn-default"  id="go_collection_status" >
							<i class="fa fa-chevron-left" aria-hidden="true"></i>
							&nbsp;수금 현황
						</button>
						<button type="button"  class="btn btn-default"  id="go_menu" >
							<i class="fa fa-list" aria-hidden="true"></i>&nbsp;
							메뉴
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>
<script th:inline="javascript">
/*<![CDATA[*/
var priceInformation = {
		grid: null,
		data: null,
}
	
$(document).ready(function() {
	priceInformationInit();
});

function priceInformationInit() {
	setTitle("돈가 시세 정보");
	priceInformationControles();
	priceInformationGridInit();
	priceInformationEventBind();
}

function priceInformationControles() {
	var today = new Date();
	var todayStr = today.getFullYear() + "-" + setTwinNum(today.getMonth() + 1) + "-" + setTwinNum(today.getDate());
	$("#yesterDay").text("(" + setTwinNum(today.getMonth() + 1) + "/" + setTwinNum(today.getDate()-1)  + ")" );
	$('#start_day').datetimepicker({
		useCurrent: false,  
		format: "YYYY-MM-DD"
	 });
	
    $('#end_day').datetimepicker({
    	format: "YYYY-MM-DD"
    });
    
    $('#start_day').val(todayStr);
    $('#end_day').val(todayStr);
    
    $("#start_day").on("dp.change", function (e) {
        $('#end_day').data("DateTimePicker").minDate(e.date);
    });
    $("#end_day").on("dp.change", function (e) {
        $('#start_day').data("DateTimePicker").maxDate(e.date);
    });

}

function priceInformationGridInit() {
	priceInformation.grid = new tui.Grid({
		el: $('#price_information_grid'),
		data: [],
		scrollX: true,
		scrollY: true,
		columns: [
			{
				title: '주간시작일',
				name: 'DT_START',
				align : "center",
				width: 100
			} ,{
				title: '주간종료일',
				name: 'DT_END',
				align : "center",
				width: 100
			} ,{
				title: '작업구분',
				name: 'GB_WORK',
				align : "center",
				width: 100
			}, {
				title: '4주평균',
				name: 'AVR_4W',
				align : "center",
				width: 130
			}, {
				title: '일',
				name: 'SUN',
				align : "center",
				width: 60,
	            formatter: function(value, options, rowData) {
	                return format(value);
	            }
			}, {
				title: '월',
				name: 'MON',
				align : "center",
				width: 60,
	            formatter: function(value, options, rowData) {
	                return format(value);
	            }
			}, {
				title: '화',
				name: 'TUE',
				align : "center",
				width: 60,
	            formatter: function(value, options, rowData) {
	                return format(value);
	            }
			}, {
				title: '수',
				name: 'WED',
				align : "center",
				width: 60,
	            formatter: function(value, options, rowData) {
	                return format(value);
	            }
			}, {
				title: '목',
				name: 'THU',
				align : "center",
				width: 60,
	            formatter: function(value, options, rowData) {
	                return format(value);
	            }
			}, {
				title: '금',
				name: 'FRI',
				align : "center",
				width: 60,
	            formatter: function(value, options, rowData) {
	                return format(value);
	            }
			}, {
				title: '토',
				name: 'SAT',
				align : "center",
				width: 60,
	            formatter: function(value, options, rowData) {
	                return format(value);
	            }
			}
			, {
				title: '주간평균',
				name: 'AVR_1W',
				align : "center",
				width: 130
			}
		]
	});
	
// 	tui.Grid.applyTheme('striped');
}

function creditSalesStatusForGetData() {
	var returnObj = new Object();
	returnObj.FunctionID = "UP_CG_MOB_PRICE_PIG_S";
	returnObj.P_DT_START = $("#start_day").val().replace(/-/gi, '').trim();
	returnObj.P_DT_END = $("#end_day").val().replace(/-/gi, '').trim();
	
	return returnObj;
}

function creditSalesStatusSearch(bodyObj) {
	$.get( "/api/getRest?restUrl=" + getUrl("RequestNtx") + "&header=" + encodedJSON(headerInfo()) + "&body=" + encodedJSON(bodyObj), function( data ) {
		if(JSON.parse(data).resultCode == "2000") {
			logOutAlert(JSON.parse(data).resultMessage);
		} else if(JSON.parse(data).resultCode != "1000" && JSON.parse(data).resultCode != "2000") {
			bootalert(JSON.parse(data).resultMessage);
			return false
		}
	}).done(function(data){
		priceInformation.data = JSON.parse(data).result.List.UP_CG_MOB_PRICE_PIG_S;
		for(var i in priceInformation.data) {
			if(i % 3 == 0) {
				priceInformation.data[i]. _extraData = {"rowSpan": {"DT_START": 3, "DT_END": 3}};
			}
		}
		console.log(priceInformation.data);
		priceInformation.grid.setData(priceInformation.data);
	}).fail(function(err) {
		console.log(err)
		bootalert(JSON.parse(data).resultMessage);
		return false;
	});
}

function priceInformationEventBind() {
	$("#go_collection_status").click(function() {
		location.href = "/sales/collection_status";
	});

	$("#go_menu").click(function() {
		location.href = "/menu";
	});
	
	$("#price_information_search").click(function() {
		creditSalesStatusSearch(creditSalesStatusForGetData())
	});
}
/*]]>*/
</script>
</div>
</html>