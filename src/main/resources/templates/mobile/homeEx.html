<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
	layout:decorator="layout/default" lang="ko">
<div  layout:fragment="content" style="background-color: #f2fbff; height: -webkit-fill-available;">
	<div class="container-fluid">
		<div class="row" >
			<img alt=""  th:src='@{/images/login.png}'  style="width: 100%;  margin-bottom: 30px;"/>
		</div>
		<div class="row"  style="background-color: #f2fbff; ">
			<div class="col-xs-offset-2 col-xs-8">
				<div class="form-horizontal">
					<div class="form-group" >
						<div class="input-group  input-group-lg">
						  <span class="input-group-addon"  >
						  	<i class="fa fa-building-o" aria-hidden="true"></i>
						  </span>
						  <input type="text" class="form-control" placeholder="Username"  value="DOUZONE"  readonly="readonly"/>
						</div>
					</div>
					<div class="form-group" >
						<div class="input-group  input-group-lg">
						  <span class="input-group-addon"  >
						  	<i class="fa fa-building-o" aria-hidden="true"></i>
						  </span>
						  <input type="text" class="form-control" placeholder="회사코드"  id="company_code" value="A000"/>
						</div>
					</div>
					<div class="form-group" >
						<div class="input-group  input-group-lg">
						  <span class="input-group-addon"  >
						  	<i class="fa fa-id-badge" aria-hidden="true"></i>
						  </span>
						  <input type="text" class="form-control" placeholder="그룹코드"  id="group_code"/>
						</div>
					</div>
					<div class="form-group"  >
						<div class="input-group  input-group-lg">
						  <span class="input-group-addon"  >
						  	<i class="fa fa-user-o" aria-hidden="true"></i>
						  </span>
						  <input type="text" class="form-control" placeholder="ID"  id="inputID" />
						</div>
					</div>
					<div class="form-group" >
						<div class="input-group  input-group-lg">
						  <span class="input-group-addon"  >
						  	<i class="fa fa-lock " aria-hidden="true"></i>
						  </span>
						  <input type="password" class="form-control" placeholder="PASSWORD"  id="inputPW" />
						</div>
					</div>
					<div class="form-group" >
						<button type="button"  class="btn  btn-lg btn-info col-xs-12"  id="btnLogin" >로그인</button>
					</div>
				</div>
			</div>
		</div>
		<div class="row text-center">
			<span class="text-warning"  style="display: none;" id="NoUserSpan"><small id="NoUserText">입력하신 사용자 정보가 존재하지 않습니다.</small></span>
		</div>
	</div>
<script type="text/javascript">
/*<![CDATA[*/
var homeEx = {
		hostUrl: null,
		headerObj: null,
		apiTable: null,
}
$(document).ready(function() {
	home01Initialise()
});

function home01Initialise() {
	homeEx.hostUrl = sessionStorage.getItem("hostUrl");
	homeEx.headerObj = JSON.parse(sessionStorage.getItem("headerObj"));
	homeEx.apiTable = JSON.parse(sessionStorage.getItem("api"));
	inputFixHeight();
	homeEventBind();
	$("#head_title").hide();
}

function inputFixHeight() {
	var inputList = $("input");
	for(var i in inputList) {
		if(i != "inputList" && i.length == 1) {
			var sapanHeght = $($($("input")[i]).parent()[0].children[0]).css("height");
			$(inputList[i]).css("height", sapanHeght);
		}
	}
}

function getSession() {
	var bodyObj = new Object();
	bodyObj.server_key = "DARBY";
	bodyObj.company = $("#company_code").val().trim();
	bodyObj.group = $("#group_code").val().trim();
	bodyObj.user = $("#inputID").val().trim();
	bodyObj.pwd = $("#inputPW").val().trim();

	var certUrl = "";
	for(var i in  homeEx.apiTable) {
		if(homeEx.apiTable[i].CD_API == "Cert") {
			certUrl = homeEx.hostUrl + "/" + homeEx.apiTable[i].NM_API;
		} 
	}
	$.get( "/api/getSession?certUrl=" + certUrl + "&body=" + encodedJSON(bodyObj), function( data ) {
		if(JSON.parse(data).resultCode == "1000") {
			$("#NoUserSpan").hide();
			homeEx.headerObj.session = JSON.parse(data).result;
			getUserInfo();
		} else {
			$("#NoUserText").text(JSON.parse(data).resultMessage);
			$("#NoUserSpan").show();
		}
	});
}

function getUserInfo() {
	var bodyObj = new Object();
	bodyObj.FunctionID = "UP_MB_COM_BROWSER_USERINFO_S"; //프로시저 명
	//프로시저 파라미터
	bodyObj.P_CD_COMPANY = $("#company_code").val().trim();
	bodyObj.P_CD_GROUP = $("#group_code").val().trim();
	bodyObj.P_ID_USER = $("#inputID").val().trim();

	var userUrl = "";
	for(var i in  homeEx.apiTable) {
		if(homeEx.apiTable[i].CD_API == "RequestNtx") {
			userUrl = homeEx.hostUrl + "/" + homeEx.apiTable[i].NM_API;
		}
	}
	
	console.log(homeEx.headerObj)
	sessionStorage.removeItem("headerObj");
	sessionStorage.setItem("headerInfo", JSON.stringify(homeEx.headerObj));
	$.get( "/api/getUserInfo?userUrl=" + userUrl + "&header=" + encodedJSON(homeEx.headerObj) + "&body=" + encodedJSON(bodyObj), function( data ) {
		if(JSON.parse(data).resultCode == "1000") {
			sessionStorage.setItem("userInfo", JSON.stringify(JSON.parse(data).result.List.UP_MB_COM_BROWSER_USERINFO_S[0]));
			location.href="/menu"
		}else {
			$("#NoUserText").show();
		}
	}).fail(function() {
		$("#NoUserText").show();
	});
}

function homeEventBind() {
	$("#btnLogin").click(function() {
		getSession();
	});
}

/*]]>*/
</script>
</div>
</html>